<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flux Web OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --neon: #00f3ff; /* Голубой неон */
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(0, 243, 255, 0.3);
            --text: #e0e0e0;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ФОН (МАТРИЦА) --- */
        #matrixCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            opacity: 0.3; /* Чтобы не мешал читать */
        }

        /* --- СТАРТОВЫЙ ЭКРАН --- */
        .home-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(10px); /* Эффект стекла */
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .home-view.hidden { transform: translateY(-100%); }

        .logo-big {
            font-size: 4rem;
            color: var(--neon);
            text-shadow: 0 0 20px var(--neon);
            margin-bottom: 40px;
            letter-spacing: 5px;
            text-transform: uppercase;
        }

        .search-wrap {
            position: relative;
            width: 90%;
            max-width: 500px;
        }

        .main-input {
            width: 100%;
            background: var(--glass);
            border: 1px solid var(--border);
            color: #fff;
            padding: 20px;
            font-size: 1.2rem;
            text-align: center;
            font-family: inherit;
            border-radius: 50px; /* Круглые края */
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            transition: 0.3s;
        }

        .main-input:focus {
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.4);
            border-color: var(--neon);
        }

        .status-text {
            margin-top: 20px;
            font-size: 0.8rem;
            color: var(--neon);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* --- БРАУЗЕР --- */
        .browser-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 20;
            background: #111;
        }

        .browser-view.active { transform: translateY(0); }

        .toolbar {
            height: 60px;
            background: rgba(0,0,0,0.9);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 15px;
            z-index: 50;
        }

        .btn-icon {
            background: none;
            border: 1px solid var(--border);
            color: var(--neon);
            width: 40px; height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            transition: 0.3s;
        }
        .btn-icon:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }

        .address-bar {
            flex-grow: 1;
            background: rgba(255,255,255,0.05);
            border: none;
            color: #fff;
            padding: 10px 15px;
            border-radius: 20px;
            font-family: inherit;
            text-align: center;
        }

        /* Индикатор загрузки */
        .loader-line {
            height: 2px;
            background: var(--neon);
            width: 0%;
            position: absolute;
            top: 60px; left: 0;
            transition: width 0.2s;
            box-shadow: 0 0 10px var(--neon);
            z-index: 51;
        }

        iframe {
            flex-grow: 1;
            border: none;
            background: #fff;
            width: 100%;
        }

        /* Адаптив */
        @media (max-width: 600px) {
            .logo-big { font-size: 2.5rem; }
            .toolbar { padding: 0 10px; gap: 8px; }
            .btn-icon { width: 35px; height: 35px; font-size: 1rem; }
        }
    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div class="home-view" id="homeView">
        <div class="logo-big">FLUX WEB</div>
        <div class="search-wrap">
            <input type="text" class="main-input" id="startInput" placeholder="Введите запрос..." autocomplete="off">
        </div>
        <div class="status-text">SECURE CONNECTION :: ACTIVE</div>
    </div>

    <div class="browser-view" id="browserView">
        <div class="toolbar">
            <button class="btn-icon" onclick="goHome()">⌂</button>
            <button class="btn-icon" onclick="window.history.back()">←</button>
            <input type="text" class="address-bar" id="urlBar">
            <button class="btn-icon" onclick="navigate()">Go</button>
        </div>
        <div class="loader-line" id="loader"></div>
        <iframe id="viewer" src=""></iframe>
    </div>

    <script>
        // --- МАТРИЦА (ФОН) ---
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const chars = "FLUXWEB01XY";
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.ceil(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.1)'; // След
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00f3ff'; // Неоновый цвет
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.98) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 50);
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };


        // --- БРАУЗЕР ---
        const home = document.getElementById('homeView');
        const browser = document.getElementById('browserView');
        const startInput = document.getElementById('startInput');
        const urlBar = document.getElementById('urlBar');
        const viewer = document.getElementById('viewer');
        const loader = document.getElementById('loader');

        const SHORTCUTS = {
            'vk': 'vk.com', 'вк': 'vk.com', 
            'yt': 'youtube.com', 'ютуб': 'youtube.com',
            'google': 'google.com'
        };

        function getUrl(val) {
            val = val.trim().toLowerCase();
            if (SHORTCUTS[val]) val = SHORTCUTS[val];
            if ((val.includes('.') && !val.includes(' ')) || val.startsWith('http')) {
                return val.startsWith('http') ? val : 'https://' + val;
            }
            return `https://duckduckgo.com/?q=${encodeURIComponent(val)}`;
        }

        function load(urlVal) {
            // Анимация загрузки
            loader.style.width = '70%';
            
            const target = getUrl(urlVal);
            // Всегда используем прокси!
            const proxyUrl = `/api/proxy?url=${encodeURIComponent(target)}`;
            
            viewer.src = proxyUrl;
            urlBar.value = target;

            // Завершение загрузки (эмуляция)
            viewer.onload = () => { loader.style.width = '0%'; };
        }

        function start() {
            if(!startInput.value) return;
            home.classList.add('hidden');
            browser.classList.add('active');
            load(startInput.value);
        }

        function navigate() {
            load(urlBar.value);
        }

        function goHome() {
            home.classList.remove('hidden');
            browser.classList.remove('active');
            viewer.src = '';
            startInput.value = '';
            loader.style.width = '0%';
        }

        // Обработка сообщений от iframe (клики по ссылкам внутри прокси)
        window.addEventListener('message', e => {
            if(e.data.type === 'navigate') {
                load(e.data.url);
            }
        });

        startInput.addEventListener('keydown', e => { if(e.key === 'Enter') start() });
        urlBar.addEventListener('keydown', e => { if(e.key === 'Enter') navigate() });

    </script>
</body>
</html>
