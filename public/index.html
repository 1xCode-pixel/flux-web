<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flux Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --fg: #ffffff;
            --gray: #333333;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: 'Courier Prime', monospace; /* Моноширинный шрифт */
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ФОН (МАТРИЦА) --- */
        #matrixCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none; /* Пропускает клики */
        }
        
        /* Видна только в режиме защиты */
        body.protected-mode #matrixCanvas {
            opacity: 0.4;
        }

        /* --- ГЛАВНЫЙ ЭКРАН --- */
        .home-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background: var(--bg); /* Сплошной черный */
            transition: transform 0.5s ease;
        }

        .home-view.hidden { transform: translateY(-100%); }

        .logo {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 50px;
            letter-spacing: -2px;
            text-transform: uppercase;
            border: 2px solid #fff;
            padding: 10px 20px;
            background: #000;
        }

        .search-wrap {
            width: 90%;
            max-width: 600px;
            border-bottom: 2px solid #fff;
        }

        .main-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            font-family: inherit;
        }
        
        .main-input::placeholder { color: #555; }

        /* --- ПЕРЕКЛЮЧАТЕЛЬ (ЧБ) --- */
        .toggle-btn {
            margin-top: 40px;
            background: transparent;
            border: 1px solid #fff;
            color: #fff;
            padding: 10px 30px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            text-transform: uppercase;
            transition: 0.2s;
        }

        .toggle-btn:hover {
            background: #fff;
            color: #000;
        }

        /* Стиль кнопки, когда защита включена */
        body.protected-mode .toggle-btn {
            background: #fff;
            color: #000;
            box-shadow: 0 0 15px #fff;
        }


        /* --- БРАУЗЕР (ВНУТРЕННИЙ) --- */
        .browser-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            z-index: 20;
            background: var(--bg);
        }

        .browser-view.active { transform: translateY(0); }

        .toolbar {
            height: 50px;
            border-bottom: 2px solid #fff;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            background: #000;
        }

        .tool-btn {
            background: #000;
            color: #fff;
            border: 1px solid #fff;
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        .tool-btn:hover { background: #fff; color: #000; }

        .url-display {
            flex-grow: 1;
            text-align: center;
            font-size: 0.8rem;
            border: 1px solid #333;
            padding: 5px;
        }

        iframe {
            flex-grow: 1;
            border: none;
            background: #fff; /* Сайты обычно белые */
        }

        .status-msg {
            margin-top: 10px;
            font-size: 0.7rem;
            color: #555;
        }
    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div class="home-view" id="homeView">
        <div class="logo">FLUX</div>
        
        <div class="search-wrap">
            <input type="text" class="main-input" id="searchInput" placeholder="Введите запрос..." autocomplete="off" autofocus>
        </div>

        <button class="toggle-btn" onclick="toggleProtection()" id="protectBtn">ЗАЩИТА: ВЫКЛ</button>
        <div class="status-msg" id="statusMsg">РЕЖИМ: YANDEX ПОИСК</div>
    </div>

    <div class="browser-view" id="browserView">
        <div class="toolbar">
            <button class="tool-btn" onclick="exitProtected()">X</button>
            <button class="tool-btn" onclick="document.getElementById('viewer').contentWindow.history.back()">&lt;</button>
            <div class="url-display" id="browserUrl">SECURE PROXY</div>
        </div>
        <iframe id="viewer" src=""></iframe>
    </div>

    <script>
        // --- ПЕРЕМЕННЫЕ ---
        let isProtected = false;
        const searchInput = document.getElementById('searchInput');
        const protectBtn = document.getElementById('protectBtn');
        const statusMsg = document.getElementById('statusMsg');
        const homeView = document.getElementById('homeView');
        const browserView = document.getElementById('browserView');
        const viewer = document.getElementById('viewer');

        // --- ЛОГИКА ЗАЩИТЫ ---
        function toggleProtection() {
            isProtected = !isProtected;
            const body = document.body;

            if (isProtected) {
                // ВКЛЮЧАЕМ
                body.classList.add('protected-mode');
                protectBtn.innerText = "ЗАЩИТА: ВКЛ";
                statusMsg.innerText = "РЕЖИМ: АНОНИМНЫЙ ПРОКСИ";
                startMatrix();
            } else {
                // ВЫКЛЮЧАЕМ
                body.classList.remove('protected-mode');
                protectBtn.innerText = "ЗАЩИТА: ВЫКЛ";
                statusMsg.innerText = "РЕЖИМ: YANDEX ПОИСК";
                stopMatrix();
            }
            searchInput.focus();
        }

        // --- ЛОГИКА ПОИСКА ---
        function handleSearch() {
            const val = searchInput.value.trim();
            if (!val) return;

            if (isProtected) {
                // === 1. ЗАЩИЩЕННЫЙ РЕЖИМ (Внутри сайта) ===
                
                let targetUrl;
                // Проверяем, ссылка это или запрос
                if ((val.includes('.') && !val.includes(' ')) || val.startsWith('http')) {
                    targetUrl = val.startsWith('http') ? val : 'https://' + val;
                } else {
                    // Используем DuckDuckGo для защиты
                    targetUrl = `https://duckduckgo.com/?q=${encodeURIComponent(val)}`;
                }

                // Переключаем экран
                homeView.classList.add('hidden');
                browserView.classList.add('active');
                document.getElementById('browserUrl').innerText = targetUrl;
                
                // Загружаем через наш API
                viewer.src = `/api/proxy?url=${encodeURIComponent(targetUrl)}`;

            } else {
                // === 2. ОБЫЧНЫЙ РЕЖИМ (Переход в Яндекс) ===
                
                let yandexLink;
                if ((val.includes('.') && !val.includes(' ')) || val.startsWith('http')) {
                    // Если ввели сайт (например vk.com) -> идем прямо на сайт
                     yandexLink = val.startsWith('http') ? val : 'https://' + val;
                } else {
                    // Если ввели запрос -> идем в поиск Яндекса
                    yandexLink = `https://yandex.ru/search/?text=${encodeURIComponent(val)}`;
                }
                
                // Прямой переход (редирект)
                window.location.href = yandexLink;
            }
        }

        function exitProtected() {
            homeView.classList.remove('hidden');
            browserView.classList.remove('active');
            viewer.src = ''; // Останавливаем загрузку
            searchInput.value = '';
            searchInput.focus();
        }

        // Enter запускает поиск
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSearch();
        });


        // --- БЕЛАЯ МАТРИЦА ---
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let matrixInterval;
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const chars = "10"; // Бинарный стиль
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.ceil(columns)).fill(1);

        function drawMatrix() {
            // Черный фон с легкой прозрачностью (след)
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ЧИСТО БЕЛЫЙ ЦВЕТ
            ctx.fillStyle = '#ffffff'; 
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        function startMatrix() {
            if (!matrixInterval) matrixInterval = setInterval(drawMatrix, 50);
        }

        function stopMatrix() {
            clearInterval(matrixInterval);
            matrixInterval = null;
            ctx.clearRect(0,0,canvas.width, canvas.height);
        }
        
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };

    </script>
</body>
</html>
