<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux Browser</title>
    <style>
        :root {
            --bg: #050505;
            --fg: #e0e0e0;
            --font: 'Courier New', monospace;
            --accent: #fff;
            --green: #00ff41;
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: var(--font);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* --- –§–û–ù–û–í–ê–Ø –ú–ê–¢–†–ò–¶–ê (–ó–ê–©–ò–¢–ê) --- */
        canvas#matrixCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0; /* –ù–∞ —Å–∞–º–æ–º –¥–Ω–µ */
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
        }
        
        body.secure-mode canvas#matrixCanvas {
            opacity: 0.25; /* –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ */
        }

        /* --- 1. –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù (HOME) --- */
        .home-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
            background: var(--bg);
        }

        /* –ö–ª–∞—Å—Å, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .home-screen.hidden {
            transform: translateY(-100vh); 
        }

        h1.logo {
            font-size: 4rem;
            letter-spacing: 10px;
            margin-bottom: 40px;
            text-transform: uppercase;
            cursor: default;
        }

        .search-container {
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        input.main-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 2px solid #333;
            color: #fff;
            font-size: 1.5rem;
            padding: 15px;
            text-align: center;
            font-family: var(--font);
            transition: 0.3s;
        }
        
        input.main-input:focus { border-bottom-color: var(--accent); }

        .home-btns {
            margin-top: 30px;
            display: flex;
            gap: 20px;
        }


        /* --- 2. –≠–ö–†–ê–ù –ë–†–ê–£–ó–ï–†–ê (BROWSER) --- */
        .browser-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            transform: translateY(100vh); /* –°–ø—Ä—è—Ç–∞–Ω –≤–Ω–∏–∑—É */
            transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
            z-index: 20;
            background: var(--bg);
        }

        .browser-screen.active {
            transform: translateY(0);
        }

        .toolbar {
            height: 60px;
            background: #000;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            z-index: 100;
        }

        .mini-logo { font-weight: bold; cursor: pointer; }

        .url-bar {
            flex-grow: 1;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: var(--font);
            font-size: 1rem;
        }
        
        body.secure-mode .url-bar {
            border-color: var(--green);
            color: var(--green);
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.3);
        }

        button.btn {
            background: transparent;
            border: 1px solid #444;
            color: #aaa;
            padding: 6px 12px;
            cursor: pointer;
            font-family: var(--font);
            text-transform: uppercase;
            font-size: 0.8rem;
            transition: 0.2s;
        }
        button.btn:hover { border-color: #fff; color: #fff; }

        button.btn-protect { color: #888; border-color: #888; }
        body.secure-mode button.btn-protect { 
            color: var(--green); border-color: var(--green); 
            background: rgba(0,255,65, 0.1); 
        }

        iframe#viewer {
            flex-grow: 1;
            border: none;
            background: #fff;
        }

        /* --- 3. –ü–ê–ù–ï–õ–¨ –ò–°–¢–û–†–ò–ò --- */
        .history-panel {
            position: fixed;
            top: 0; right: -320px; /* –°–∫—Ä—ã—Ç–∞ –∑–∞ —ç–∫—Ä–∞–Ω–æ–º */
            width: 300px;
            height: 100%;
            background: #0a0a0a;
            border-left: 1px solid #333;
            z-index: 200; /* –ü–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .history-panel.open { right: 0; }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .history-list { flex-grow: 1; }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid #222;
            cursor: pointer;
            font-size: 0.8rem;
            color: #888;
        }
        .history-item:hover { color: #fff; background: #111; }
        .time-stamp { color: #555; font-size: 0.7rem; margin-bottom: 3px; }

    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div class="home-screen" id="homeScreen">
        <h1 class="logo">FLUX</h1>
        <div class="search-container">
            <input type="text" class="main-input" id="mainInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏–ª–∏ '–≤–∫'..." autofocus autocomplete="off">
        </div>
        <div class="home-btns">
            <button class="btn" onclick="startSearch()">–ü–æ–∏—Å–∫</button>
            <button class="btn btn-protect" id="homeProtectBtn" onclick="toggleProtection()">–ó–∞—â–∏—Ç–∞: OFF</button>
        </div>
    </div>

    <div class="browser-screen" id="browserScreen">
        <div class="toolbar">
            <div class="mini-logo" onclick="goHome()">FLUX</div>
            <button class="btn" onclick="window.history.back()">‚Üê</button>
            
            <input type="text" class="url-bar" id="browserInput" autocomplete="off">
            
            <button class="btn" onclick="browserSearch()">GO</button>
            <button class="btn" onclick="toggleHistory()">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="btn btn-protect" id="browserProtectBtn" onclick="toggleProtection()">üõ°Ô∏è</button>
        </div>
        <iframe id="viewer" src=""></iframe>
    </div>

    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <h3>–ò–°–¢–û–†–ò–Ø</h3>
            <button class="btn" onclick="toggleHistory()">X</button>
        </div>
        <button class="btn" onclick="clearHistory()" style="width: 100%; margin-bottom: 15px;">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
        <div class="history-list" id="historyList">
            </div>
    </div>

    <script>
        // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        let isSecure = false;
        let historyData = JSON.parse(localStorage.getItem('fluxHistory')) || [];

        const homeScreen = document.getElementById('homeScreen');
        const browserScreen = document.getElementById('browserScreen');
        const mainInput = document.getElementById('mainInput');
        const browserInput = document.getElementById('browserInput');
        const viewer = document.getElementById('viewer');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');

        // –ö–Ω–æ–ø–∫–∏ –∑–∞—â–∏—Ç—ã (–∏—Ö –¥–≤–µ, –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö)
        const homeProtectBtn = document.getElementById('homeProtectBtn');
        const browserProtectBtn = document.getElementById('browserProtectBtn');

        // –®–æ—Ä—Ç–∫–∞—Ç—ã
        const SHORTCUTS = {
            '–≤–∫': 'vk.com', 'vk': 'vk.com',
            '—é—Ç—É–±': 'youtube.com', '–≥—É–≥–ª': 'google.com', '—è–Ω–¥–µ–∫—Å': 'ya.ru'
        };

        // --- –õ–û–ì–ò–ö–ê –ü–û–ò–°–ö–ê –ò URL ---
        
        function processInput(rawInput) {
            // 1. –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –ú–ê–õ–ï–ù–¨–ö–ò–ï –ë–£–ö–í–´
            let val = rawInput.trim().toLowerCase();
            
            if(!val) return null;

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–æ—Ä—Ç–∫–∞—Ç–æ–≤
            if (SHORTCUTS[val]) val = SHORTCUTS[val];

            // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
            let targetUrl = '';
            if ((val.includes('.') && !val.includes(' ')) || val.startsWith('http')) {
                // –≠—Ç–æ —Å—Å—ã–ª–∫–∞
                targetUrl = val.startsWith('http') ? val : `https://${val}`;
            } else {
                // –≠—Ç–æ –ø–æ–∏—Å–∫
                targetUrl = `https://duckduckgo.com/?q=${encodeURIComponent(val)}`;
            }
            return targetUrl;
        }

        function loadUrl(url) {
            if (isSecure) {
                // –ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
                viewer.src = `/api/proxy?url=${encodeURIComponent(url)}`;
            } else {
                // –ù–∞–ø—Ä—è–º—É—é
                viewer.src = url;
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory(url);
        }

        // –ó–∞–ø—É—Å–∫ —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        function startSearch() {
            const url = processInput(mainInput.value);
            if (!url) return;

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            homeScreen.classList.add('hidden');
            browserScreen.classList.add('active');
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–Ω–ø—É—Ç—ã
            browserInput.value = url;
            loadUrl(url);
        }

        // –ó–∞–ø—É—Å–∫ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
        function browserSearch() {
            const url = processInput(browserInput.value);
            if (!url) return;
            loadUrl(url);
        }

        // –ö–Ω–æ–ø–∫–∞ "–î–æ–º–æ–π"
        function goHome() {
            homeScreen.classList.remove('hidden');
            browserScreen.classList.remove('active');
            viewer.src = '';
            mainInput.value = '';
            mainInput.focus();
        }

        // Enter —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
        mainInput.addEventListener('keydown', e => { if(e.key === 'Enter') startSearch() });
        browserInput.addEventListener('keydown', e => { if(e.key === 'Enter') browserSearch() });


        // --- –õ–û–ì–ò–ö–ê –ó–ê–©–ò–¢–´ ---
        function toggleProtection() {
            isSecure = !isSecure;
            const body = document.body;

            if (isSecure) {
                body.classList.add('secure-mode');
                homeProtectBtn.textContent = "–ó–∞—â–∏—Ç–∞: ON";
                startMatrix();
            } else {
                body.classList.remove('secure-mode');
                homeProtectBtn.textContent = "–ó–∞—â–∏—Ç–∞: OFF";
                stopMatrix();
            }

            // –ï—Å–ª–∏ —Å–∞–π—Ç —É–∂–µ –æ—Ç–∫—Ä—ã—Ç, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –≤ –Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
            if (browserScreen.classList.contains('active') && browserInput.value) {
                const url = processInput(browserInput.value);
                loadUrl(url);
            }
        }

        // --- –õ–û–ì–ò–ö–ê –ò–°–¢–û–†–ò–ò ---
        function toggleHistory() {
            historyPanel.classList.toggle('open');
            renderHistory();
        }

        function addToHistory(url) {
            const time = new Date().toLocaleTimeString().slice(0, 5); // 14:30
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
            historyData.unshift({ url, time });
            // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ 30 –∑–∞–ø–∏—Å–µ–π
            if (historyData.length > 30) historyData.pop();
            localStorage.setItem('fluxHistory', JSON.stringify(historyData));
        }

        function renderHistory() {
            historyList.innerHTML = '';
            historyData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<div class="time-stamp">${item.time}</div>${item.url}`;
                div.onclick = () => {
                    browserInput.value = item.url;
                    browserSearch();
                    toggleHistory(); // –∑–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å
                };
                historyList.appendChild(div);
            });
        }

        function clearHistory() {
            historyData = [];
            localStorage.removeItem('fluxHistory');
            renderHistory();
        }

        // --- –ú–ê–¢–†–ò–¶–ê (–§–û–ù) ---
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let matrixInterval;
        const chars = "#%&"; 

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.ceil(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff'; 
            ctx.font = fontSize + 'px Courier New';

            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        function startMatrix() {
            if (matrixInterval) return;
            matrixInterval = setInterval(drawMatrix, 50);
        }

        function stopMatrix() {
            clearInterval(matrixInterval);
            matrixInterval = null;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        // –†–µ—Å–∞–π–∑
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };

    </script>
</body>
</html>
