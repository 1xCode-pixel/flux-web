<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux Web</title>
    <style>
        /* --- Flux Design System --- */
        :root {
            --bg: #000;
            --fg: #fff;
            --border: #333;
            --font: 'Courier New', monospace;
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: var(--font);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ */
        .browser-toolbar {
            height: 60px;
            border-bottom: 1px solid var(--fg);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            background: var(--bg);
            z-index: 100;
        }

        .logo { font-weight: bold; font-size: 1.2rem; margin-right: 10px; cursor: default; }

        /* –ê–¥—Ä–µ—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ */
        .url-input {
            flex-grow: 1;
            background: #111;
            border: 1px solid var(--border);
            color: var(--fg);
            padding: 10px;
            font-family: var(--font);
            font-size: 1rem;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: var(--bg);
            color: var(--fg);
            border: 1px solid var(--fg);
            padding: 8px 15px;
            cursor: pointer;
            font-family: var(--font);
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        .btn:hover { background: var(--fg); color: var(--bg); }
        .btn-protect { border-color: red; color: red; }
        .btn-protect:hover { background: red; color: white; }

        /* –û–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (iframe) */
        #viewport {
            flex-grow: 1;
            border: none;
            width: 100%;
            background: #fff; /* –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–∞–π—Ç–æ–≤ —Å–≤–µ—Ç–ª—ã–µ, –Ω—É–∂–µ–Ω –±–µ–ª—ã–π —Ñ–æ–Ω –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è */
        }

        /* –ü–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ (–≤—ã–¥–≤–∏–∂–Ω–∞—è) */
        .history-panel {
            position: fixed;
            top: 60px;
            right: -300px; /* –°–∫—Ä—ã—Ç–∞ */
            width: 300px;
            height: calc(100% - 60px);
            background: #0a0a0a;
            border-left: 1px solid var(--fg);
            transition: right 0.3s ease;
            z-index: 90;
            padding: 20px;
            overflow-y: auto;
        }
        .history-panel.open { right: 0; }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            font-size: 0.8rem;
            word-break: break-all;
        }
        .history-item:hover { background: #222; }

        /* –ú–∞—Ç—Ä–∏—Ü–∞ (–∑–∞—â–∏—Ç–∞) - –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ */
        #matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999; /* –°–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π */
            pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–ª–∏–∫–∏, –ø–æ–∫–∞ —Å–∫—Ä—ã—Ç */
            opacity: 0;
            transition: opacity 0.5s;
            background: black;
        }
        
        .protection-active #matrixCanvas {
            opacity: 1;
            pointer-events: auto; /* –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∫–ª–∏–∫–∏ –ø–æ —Å–∞–π—Ç—É */
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞—â–∏—Ç–µ */
        .lock-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            font-size: 2rem;
            background: #000;
            padding: 20px;
            border: 1px solid #fff;
            display: none;
        }
        .protection-active .lock-message { display: block; }

    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>
    <div class="lock-message">–ó–ê–©–ò–¢–ê –ê–ö–¢–ò–í–ù–ê<br><button class="btn" style="margin-top:20px" onclick="toggleProtection()">–û—Ç–∫–ª—é—á–∏—Ç—å</button></div>

    <div class="browser-toolbar">
        <div class="logo">FLUX</div>
        <button class="btn" onclick="goBack()">‚Üê</button>
        <input type="text" class="url-input" id="urlInput" placeholder="–í–≤–µ–¥–∏—Ç–µ URL (google.com)..." onkeydown="if(event.key === 'Enter') navigate()">
        <button class="btn" onclick="navigate()">GO</button>
        <button class="btn" onclick="toggleHistory()">–ò—Å—Ç–æ—Ä–∏—è</button>
        <button class="btn btn-protect" onclick="toggleProtection()">üõ°Ô∏è</button>
    </div>

    <div class="history-panel" id="historyPanel">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π</h3>
        <button class="btn" onclick="clearHistory()" style="width:100%; margin-bottom:10px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div id="historyList"></div>
    </div>

    <iframe id="viewport" src=""></iframe>

    <script>
        // --- –õ–æ–≥–∏–∫–∞ –ë—Ä–∞—É–∑–µ—Ä–∞ ---
        
        const viewport = document.getElementById('viewport');
        const urlInput = document.getElementById('urlInput');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        let history = JSON.parse(localStorage.getItem('fluxHistory')) || [];
        renderHistory();

        function navigate(url) {
            let target = url || urlInput.value;
            if (!target) return;

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory(target);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
            // encodeURIComponent –≤–∞–∂–µ–Ω, —á—Ç–æ–±—ã —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ URL –Ω–µ —Å–ª–æ–º–∞–ª–∏ –∑–∞–ø—Ä–æ—Å
            viewport.src = `/api/proxy?url=${encodeURIComponent(target)}`;
            
            // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–ø—É—Ç
            if(url) urlInput.value = url;
        }

        function goBack() {
            // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è "–Ω–∞–∑–∞–¥" –¥–ª—è iframe
            viewport.contentWindow.history.back();
        }

        function toggleHistory() {
            historyPanel.classList.toggle('open');
        }

        function addToHistory(url) {
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞
            history.unshift({ url: url, time: new Date().toLocaleTimeString() });
            // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π
            if (history.length > 50) history.pop();
            localStorage.setItem('fluxHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<span>${item.time}</span><br>${item.url}`;
                div.onclick = () => navigate(item.url);
                historyList.appendChild(div);
            });
        }

        function clearHistory() {
            history = [];
            localStorage.removeItem('fluxHistory');
            renderHistory();
        }

        // --- –õ–æ–≥–∏–∫–∞ –ú–∞—Ç—Ä–∏—Ü—ã (–ó–∞—â–∏—Ç–∞) ---

        let isProtected = false;
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let animationInterval;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const binary = "10";
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.ceil(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0F0'; // –ó–µ–ª–µ–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –±–µ–ª—ã–π '#fff'
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = binary.charAt(Math.floor(Math.random() * binary.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        function toggleProtection() {
            isProtected = !isProtected;
            if (isProtected) {
                document.body.classList.add('protection-active');
                animationInterval = setInterval(drawMatrix, 50);
            } else {
                document.body.classList.remove('protection-active');
                clearInterval(animationInterval);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // –†–µ—Å–∞–π–∑ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

    </script>
</body>
</html>
